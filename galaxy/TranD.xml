<tool id="transcript_distance" name="TranD" version="@WRAPPER_VERSION@">
  <description></description> 
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements" />
  <command detect_errors="exit_code"><![CDATA[

## Begin TranD Command Line
  mkdir outputs;
  cd outputs;
  trand

##Set parameters when running with one GTF files 

    #if str( $gtf_input.gtfNum ) == "gtf1":
      $gtf1Dataset
      --ea=$gtf_input.eaMode
      #if $gtf_input.keepIR:
         --keepir
      #end if
      #if $gtf_input.consolidateCheck.consolidate == 'True'
        --consolidate 
        --consolPrefix=$gtf_input.consolidateCheck.consolPrefix
      #end if
    #end if

##Set parameters when running with two GTF files 
    #if str( $gtf_input.gtfNum ) == "gtf2":
      $gtf1Dataset
      $gtf2Dataset
      --pairs=$gtf_input.transcriptPairs
      --name1=$gtf_input.gtf1Name
      --name2='$gtf_input.gtf2Name'
      --ea=$gtf_input.eaMode
    #end if

##Run rest of arguments 
    #if $complexityOnly
      --complexityOnly
    #end if
    #if $skipPlots     
      --skip-plots 
    #end if
    #if $skipInterm
      --skip-intermediate
    #end if
    --force

  ]]></command>
  <inputs>
    <conditional name="gtf_input">
      <param name="gtfNum" type="select" display="radio" label="Select the amount of GTF files you have as input for TranD processing">
        <option value="gtf1">One GTF File</option>
        <option value="gtf2">Two GTF Files</option>
        <validator type="no_options" message="You must select at least one option." /> 
      </param>
      <when value="gtf1">
        <param name="gtf1Dataset" type="data" format="gtf" label="Select GTF file containing transcriptomes of interest from your history" help="File must contain “exon” features with transcript_id and gene_id values indicated in attributes"/>
        <conditional name="consolidateCheck">
          <param name="consolidate" type="select" display="radio" label="Select 'Yes' to consolidate transcripts" help="Consolidating transcripts remove 5'/3' transcript end variation in redundantly spliced transcripts) with identical junctions prior to complexity calculations, events and summary plotting">
            <option value="True">Yes</option>
            <option value="False">No</option>
          </param>
          <when value="True">
            <param name="consolPrefix" type="text" value="tr" label="Specify the prefix to use for consolidated transcript_id values. Prefix must be alphanumeric with no spaces. An underscore is the only allowed special character"/> 
          </when>
        </conditional>
        <param name="eaMode" size="30" type="select" value="" display="radio" label="Choose type of comparison to do within gene transcript" help="Compare pairs of transcripts within a gene (Pairwise) or compare all transcripts within a gene (Gene)">
          <option value="pairwise" selected="true">Pairwise</option>
          <option value="gene" selected="true">Gene</option>
        </param>
        <param name="keepIR" type="boolean" label="Set to 'Yes' if you want to keep transcripts with Intron Retention regions when generating transcript events"/>
      </when>
      <when value="gtf2">
        <param name="gtf1Dataset" type="data" format="gtf" label="Select GTF file containing transcriptomes of interest from your history"/>
        <param name="gtf2Dataset" type="data" format="gtf" label="Select 2nd GTF file containing transcriptomes of interest from your history" help="Files must contain “exon” features with transcript_id and gene_id values indicated in attributes" />
        <param name="transcriptPairs" type="select" display="radio" label="Select desired transcript pairs" help="The TranD metrics can be output for all transcript pairs in both GTF files or for a subset of transcript pairs">
            <option value="first">TranD metrics for the minimum pairs in the first GTF file</option>
            <option value="second">TranD metrics for the minimum pairs in the second GTF file</option>  
            <option value="both">TranD metrics for the minimum pairs in both GTF files</option>
            <option value="all">TranD metrics for all transcript pairs in both GTF files</option>
        </param> 
        <param name="gtf1Name" type="text" label="Name to give GTF 1. Default: d1" help="User-specified name to be used for labeling output files related to first GTF file. Must be alphanumeric, cannot include any special characters except for underscores ‘_’, and cannot contain any spaces" value="d1"/>
        <param name="gtf2Name" type="text" label="Name to give GTF 2. Default: d2" value="d2" help="User-specified name to be used for output files related to second GTF file"/>
        <param name="eaMode" size="30" type="select" display="radio" value="" label="When running TranD with two GTF files, pairs of transcripts will be compared within a gene">
          <option value="pairwise" selected="true">Pairwise</option>
        </param>
      </when>
     </conditional>
        <param name="complexityOnly" type="boolean" label="Select to output only complexity calculations" help="Select this parameter if you only want complexity measures as opposed to outputting performance of all analyses (ie event analysis, etc)"/>
        <param name="skipPlots" type="boolean" label="Skip generation of all plots" help="If 'Yes', TranD will not produce any plots"/>
        <param name="skipInterm" type="boolean" label="Skip output of intermediate files" help="If 'Yes', the TranD program will not output intermediate files (such as junction and exon region/fragment files)."/>
  </inputs>
  <outputs>
    <!-- The discover datasets parameter is needed to dynamically collect the output datasets --> 
    <data format= "csv" type="list" name="counts" label="${tool.name} on ${on_string}: Complexity Counts" >
      <discover_datasets pattern="(?P&lt;name&gt;.*)\.csv" ext="csv" directory="outputs"/>
    </data>
    <collection format= "gtf" type="list" name="gtf" label="${tool.name} on ${on_string}: Consolidated GTF" >
      <discover_datasets pattern="(?P&lt;name&gt;.*)\.gtf" ext="gtf" directory="outputs"/>
    </collection>
    <collection format= "png" type="list" name="boxplots" label="${tool.name} on ${on_string}: Complexity Plots" >
      <discover_datasets pattern="(?P&lt;name&gt;.*)\.png" ext="png" directory="outputs"/>
    </collection>
    <collection format= "txt" type="list" name="figureLegend" label="${tool.name} on ${on_string}: Complexity Legend" >
      <discover_datasets pattern="(?P&lt;name&gt;.*)\.rtf" ext="rtf" directory="outputs" />
    </collection>
  </outputs>
  <tests>
  </tests>
  <help><![CDATA[

**Tool Description*

  ]]>
  </help>
  <citations>
  </citations>
</tool>
